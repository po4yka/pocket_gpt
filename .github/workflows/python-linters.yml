name: Python Linters

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2

            - name: Set up Python
              uses: actions/setup-python@v2
              with:
                  python-version: "3.9"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            # Step 1: Run and auto-apply changes with pre-commit
            - name: Run pre-commit hooks
              run: pre-commit run --all-files --hook-stage manual || true

            # Step 2: Run and auto-apply changes with black
            - name: Run black to reformat code
              run: black .

            # Step 3: Run and auto-apply changes with isort
            - name: Run isort to sort imports
              run: isort .

            # Step 4: Detect if there are changes to commit
            - name: Check for changes
              run: |
                  git config --global user.name "github-actions[bot]"
                  git config --global user.email "github-actions[bot]@users.noreply.github.com"
                  git diff --quiet || git commit -am "Apply automatic linter fixes"

            # Step 5: Push changes back to the repository if any were made
            - name: Push changes
              if: success()
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
                git push origin HEAD:refs/heads/main
